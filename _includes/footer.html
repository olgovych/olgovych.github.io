
<div class="bottom-footer">
    <span class="mini-note"></span>
</div>

<script>
(function() {
    function layoutSidenotes() {
        if (window.matchMedia('(max-width: 850px)').matches) return;
        var sidenoteNumbers = document.querySelectorAll('.sidenote-number');
        var sidenoteElements = document.querySelectorAll('.sidenote');
        var groups = new Map();
        var minLength = Math.min(sidenoteNumbers.length, sidenoteElements.length);
        for (var i = 0; i < minLength; i++) {
            var marker = sidenoteNumbers[i];
            var sidenote = sidenoteElements[i];
            var parent = sidenote.offsetParent;
            if (!parent) continue;
            var markerRect = marker.getBoundingClientRect();
            var parentRect = parent.getBoundingClientRect();
            var relativeTop = markerRect.top - parentRect.top;
            if (!groups.has(parent)) {
                groups.set(parent, []);
            }
            groups.get(parent).push({
                element: sidenote,
                markerTop: relativeTop
            });
        }
        groups.forEach(function(pairs) {
            var previousBottom = 0;
            pairs.forEach(function(pair) {
                var desiredTop = pair.markerTop;
                if (desiredTop < previousBottom) {
                    desiredTop = previousBottom;
                }
                pair.element.style.top = desiredTop + 'px';
                var sidenoteHeight = pair.element.offsetHeight;
                previousBottom = desiredTop + sidenoteHeight + 20;
            });
        });
    }
    function run() {
        requestAnimationFrame(function() {
            layoutSidenotes();
        });
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', run);
    } else {
        run();
    }
    window.addEventListener('load', function() {
        layoutSidenotes();
    });
    var resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(layoutSidenotes, 150);
    });
})();
</script>
