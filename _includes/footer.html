
<div class="bottom-footer">
    <span class="mini-note"></span>
</div>

<script>
(function() {
    function layoutSidenotes() {
        // Get all sidenote markers and sidenote elements
        const sidenoteNumbers = document.querySelectorAll('.sidenote-number');
        const sidenoteElements = document.querySelectorAll('.sidenote');

        // Match markers with sidenotes by index
        const pairs = [];
        const minLength = Math.min(sidenoteNumbers.length, sidenoteElements.length);

        for (let i = 0; i < minLength; i++) {
            const marker = sidenoteNumbers[i];
            const sidenote = sidenoteElements[i];

            // Get the absolute position of the marker
            const markerRect = marker.getBoundingClientRect();
            const parent = sidenote.offsetParent;

            if (parent) {
                const parentRect = parent.getBoundingClientRect();
                const relativeTop = markerRect.top - parentRect.top;

                pairs.push({
                    marker: marker,
                    element: sidenote,
                    markerTop: relativeTop,
                    index: i
                });
            }
        }

        // Position sidenotes and prevent overlaps
        let previousBottom = 0;

        pairs.forEach((pair) => {
            let desiredTop = pair.markerTop;

            // Prevent overlap with previous sidenote
            if (desiredTop < previousBottom) {
                desiredTop = previousBottom;
            }

            // Apply position
            pair.element.style.top = desiredTop + 'px';

            // Calculate bottom position for next iteration
            const sidenoteHeight = pair.element.offsetHeight;
            previousBottom = desiredTop + sidenoteHeight + 20; // 20px gap
        });
    }

    // Run after DOM is fully loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for styles to apply
            setTimeout(layoutSidenotes, 50);
        });
    } else {
        setTimeout(layoutSidenotes, 50);
    }

    // Re-run on window resize
    let resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(layoutSidenotes, 150);
    });
})();
</script>
